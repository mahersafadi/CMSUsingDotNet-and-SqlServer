(function(e,t,n){function s(t,n){this.opts=e.extend({},r,n),this.klass="tiles-"+this.opts.effect,this.klassNormal=this.klass+"-normal",this.klassAnim=this.klass+"-anim",this.n_tiles=this.opts.x*this.opts.y,this.$container=e(t),this.$images=this.$container.find("img"),this.imgWidth=this.$container.width(),this.imgHeight=this.$container.height(),this.timeouts=[],this.slideshow=null,this.isAnimating=null,this.$navLinks=null,this.$descriptions=null,this.$timer=null,this.opts.rewind&&(this.opts.fade=!0),this._init()}var r={x:4,y:4,slider:!1,effect:"default",fade:!1,random:!1,reverse:!1,backReverse:!1,limit:!1,rewind:!1,auto:!1,loop:!1,slideSpeed:3500,tileSpeed:800,cssSpeed:300,nav:!0,bullets:!0,navWrap:null,thumbs:!0,thumbSize:25,timer:!0,beforeChange:e.noop,afterChange:e.noop,onSlideshowEnd:e.noop},i={range:function(e,t,n){var r=(new Array(++t-e)).join(".").split(".").map(function(t,n){return e+n});return n?r.map(function(e){return[Math.random(),e]}).sort().map(function(e){return e[1]}):r}};s.prototype={_init:function(){var n=this,r=n.opts;if(!n.$images.length)return!1;n.$container.addClass("tiles-slider-wrap tiles-slider-"+r.effect+" tiles-slider-s"+r.cssSpeed),n.$images.each(function(){n._generateTiles(e(this))}),n.$wraps=n.$container.find(".tiles-wrap").detach(),n.$wraps.first().addClass("tiles-wrap-current").appendTo(n.$container),r.nav&&(n._addNav(),n.$navLinks=n.$container.find(".tiles-nav-item")),r.timer&&(n._addTimer(),n.$timer=n.$container.find(".tiles-timer")),n._setupDescriptions(),n.$descriptions=n.$container.find(".tiles-description"),n._showOrHideDescription(),e("body").addClass("tiles-preload"),e(t).load(function(){e("body").removeClass("tiles-preload")}),r.auto&&n.start()},_addTimer:function(){this.$container.append('<div class="tiles-timer"/>')},_updateTimer:function(){this.opts.timer&&this.$timer.animate({width:"100%"},this.opts.slideSpeed,"linear")},_resetTimer:function(){this.opts.timer&&this.$timer.stop(!0).width(0)},_addNav:function(){var t=this,n=t.opts,r=e(n.navWrap||"<div/>").addClass("tiles-nav"),i=[],s,o,u=e('<a href="#" class="tiles-next">Next &raquo;</a>'),a=e('<a href="#" class="tiles-prev">&laquo; Prev</a>'),f=t.imgHeight*n.thumbSize/100,l=t.imgWidth*n.thumbSize/100;for(var c=1;c<t.$wraps.length+1;c++)o='<span><img src="'+t.$images.eq(c-1).attr("src")+'"/></span>',i.push('<a href="#" class="tiles-nav-item '+(n.bullets?"tiles-bullet":"tiles-pagination")+'">'+(n.bullets?"":c)+(n.thumbs?o:"")+"</a>");s=e(i.join("")),s.click(function(){var n=e(this),r=s.index(n);t._navigate(r,e.noop)}),s.first().addClass("tiles-nav-active"),u.click(function(){t.next()}),a.click(function(){t.prev()}),s.add(u).add(a).click(function(e){e.preventDefault()}),n.navWrap?r.append(s):(t.$container.append(r.append(s)),r.css("margin-left","-"+r.outerWidth()/2+"px")),t.$container.append(a,u),s.find("img").height(f).width(l),s.find("span").each(function(){var t=e(this);t.css({top:-t.outerHeight()-r.outerHeight(),left:-(t.outerWidth()-t.parent().outerWidth())/2})})},_updateNav:function(){this.opts.nav&&this.$navLinks.removeClass("tiles-nav-active").eq(this._getCurrentIdx()).addClass("tiles-nav-active")},_setupDescriptions:function(){this.$images.each(function(){e(this).next("p").length||e(this).after("<p/>")}),this.$container.find("p").each(function(){e(this).wrapAll('<div class="tiles-description '+(e(this).is(":empty")?"tiles-description-empty":"")+'"/>')})},_showOrHideDescription:function(e){this.$descriptions.removeClass("tiles-description-active").eq(this._getCurrentIdx()).toggleClass("tiles-description-active",e)},_generateTiles:function(t){var n=this,r=n.opts,i=[],s;for(var o=0;o<n.n_tiles;o++)i.push('<div class="tiles-tile '+n.klassNormal+'"/>');s=e(i.join("")),s.addClass("tiles-x"+r.x+" tiles-y"+r.y).filter(":odd").addClass("tiles-odd").end().filter(":even").addClass("tiles-even"),s.css({width:n.imgWidth/r.x,height:n.imgHeight/r.y,backgroundImage:"url("+t.attr("src")+")"}),e('<div class="tiles-wrap"/>').append(s).insertAfter(t.hide()),s.each(function(){var t=e(this),n=t.position();t.css("backgroundPosition",-n.left+"px "+ -n.top+"px")})},_animateTiles:function(t,n){n=n||e.noop;var r=this,s=r.opts,o=i.range(0,r.n_tiles,s.random),u=Math.floor(s.tileSpeed/r.n_tiles),a=o.length/(100/s.limit),f=r.n_tiles>1?s.tileSpeed+s.cssSpeed:s.cssSpeed,l=t.find(".tiles-tile");r.isAnimating=!0,s.reverse&&(o=o.reverse()),s.limit&&(s.reverse?o.splice(0,a):o.splice(a,o.length)),o.forEach(function(e,t){var n=l.eq(e),i=t*u;setTimeout(function(){n.addClass(r.klassAnim)},i),s.rewind&&(i+=s.cssSpeed/(100/s.rewind),setTimeout(function(){n.removeClass(r.klassAnim)},i))}),setTimeout(function(){r.isAnimating=!1,n()},f)},_resetTiles:function(e){e.find(".tiles-tile").removeClass(this.klassAnim)},_getCurrentWrap:function(){return this.$wraps.filter(".tiles-wrap-current")},_getCurrentIdx:function(){return this.$wraps.index(this._getCurrentWrap())},_navigate:function(e,t){var n=this,r=n.opts,i=n._getCurrentWrap(),s=n.$wraps.eq(e),o=n._getCurrentIdx();return e===o||n.isAnimating?!1:(n.$container.find(".tiles-wrap").removeClass("tiles-wrap-current"),s.addClass("tiles-wrap-current").prependTo(n.$container),r.fade&&s.fadeOut(1).fadeIn(r.tileSpeed),r.rewind&&i.fadeIn(1).delay(r.tileSpeed/2).fadeOut(r.tileSpeed),r.backReverse&&(r.reverse=e<o),n._animateTiles(i,function(){i.remove(),n._resetTiles(i),n._showOrHideDescription(!0),n.slideshow&&n.stop().start(),t&&t(),r.afterChange()}),r.beforeChange(),n._updateNav(),n._resetTimer(),n._showOrHideDescription(!1),this)},prev:function(t){var n=this,r=n._getCurrentWrap(),i=r.is(n.$wraps.first()),s=i?n.$wraps.length-1:n._getCurrentIdx()-1;return this._navigate(s,t||e.noop)},next:function(t){var n=this,r=n._getCurrentWrap(),i=r.is(n.$wraps.last()),s=i?0:n._getCurrentIdx()+1;return this._navigate(s,t||e.noop)},start:function(){var e=this,t=e.opts,n=t.slideSpeed+t.cssSpeed,r=n*(e.$wraps.length-e._getCurrentIdx());return e.n_tiles>1&&(r+=t.tileSpeed),this.slideshow=!0,e.timeouts.push(setTimeout(function(){e.next()},t.slideSpeed)),t.loop||e.timeouts.push(setTimeout(function(){e.stop(),t.onSlideshowEnd()},r)),this._updateTimer(),this},stop:function(){return this.timeouts.forEach(function(e){clearTimeout(e)}),this.slideshow=!1,this._resetTimer(),this}},e.fn.tilesSlider=function(t){var n=Array.prototype.slice.call(arguments,1);return this.each(function(){if(typeof t=="string"){var r=e.data(this,"tiles-slider");r[t].apply(r,n)}else e.data(this,"tiles-slider")||e.data(this,"tiles-slider",new s(this,t))})}})(jQuery,window);